
  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   13.0   Copyright 1985-2013 StataCorp LP
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

2-user 16-core Stata network perpetual license:
       Serial number:  501306200703
         Licensed to:  HPC, ITS
                       New York University, NY

Notes:
      1.  (-v# option or -set maxvar-) 5000 maximum variables
      2.  Command line editing disabled
      3.  Stata running in batch mode

Note:  Your site can add messages to the introduction by editing the file
       stata.msg in the directory where Stata is installed.

. do 130812_regressions_allyears_tenuredays.do 

. * REGRESSIONS IN ALL YEARS
. * USE THE DEFINITION OF TENURE BASED ON THE DAYS WORKED and SEPARATION IN THA
> T YEAR
. 
. local filepath "/scratch/kb103/stata/earnings_losses"

. 
. * CREATE FILES THE REGRESSIONS
. /*
> forval yy = 1976/2005{
> 
>         use "`filepath'/control_treatment_ind_year`yy'.dta"
>         keep if CG5_men==1 | CG5_women==1
>         keep pid CG5*
>         by pid: gen int index = _n
>         keep if index==1
>         drop index
>         saveold "`filepath'/EL_pid_CG5`yy'.dta", replace
> 
>         use "`filepath'/control_treatment_ind_year`yy'.dta"
>         keep if TG5_men==1 | TG5_women==1
>         by pid: gen int index = _n
>         keep if index == 1
>         drop index
>         keep pid TG5*
>         saveold "`filepath'/EL_pid_TG5`yy'.dta", replace
>         
> }
> */
. * REGRESSION FILES
. /*
> forval yy = 1976/2003{  
> 
>         * DEAL WITH DUPLICATE OBSERVATIONS - IF A WORKER IS IN MORE THAN ONE 
> TREATMENT/CONTROL GROUP
>         local endy = `yy'+2
>         local begy = `yy'+1
>         use "`filepath'/EL_pid_CG5`yy'.dta"     
>         forval yy1 = `yy'/`endy'{
>                 append using "`filepath'/EL_pid_TG5`yy1'.dta"
>         }
>         keep pid 
>         sort pid
>         by pid: gen int index = _n
>         by pid: egen int maxindex = max(index)
>         drop if maxindex>1
>         keep if index==1
>         keep pid
>         save  "`filepath'/EL_`yy'_CTG5tokeep.dta", replace
>         
>         * CREATE A FILE FOR REGRESSION
>         clear
>         use "`filepath'/EL_annual_income_year`yy'.dta" 
>         keep if CG5_men==1 | CG5_women==1 | TG5_men==1 | TG5_women==1
>         forval yy1 = `begy'/`endy'{
>                 append using "`filepath'/EL_annual_income_year`yy1'.dta"
>         }
>         merge m:1 pid using "`filepath'/EL_`yy'_CTG5tokeep.dta"
>         keep if _merge==3
>         drop _merge
>   
>         save "`filepath'/regression_annual_income_year_CTG5`yy'.dta" , replac
> e
>         
> }
> */
. 
. ***** REGRESSIONS **************************************************
. 
. forval yy = 1976/2003{          
  2.         use "`filepath'/regression_annual_income_year_CTG5`yy'.dta" , clea
> r
  3.         gen byte treatment =1 if TG5_men ==1 |TG5_women ==1
  4.         
.         * GENERATE Dtk dummies
.         
.         gen int current_year = .
  5.         local maxround = 2007-`yy'
  6.         
.         forval kk = -6/`maxround'{
  7.                 
.                 replace current_year = year_mass_layoff +`kk' 
  8.                 
.                 local kx = `kk' + 6
  9.                 
.                 gen byte D_`kx' = 0
 10.                 replace D_`kx' = 1 if treatment == 1 & year == current_yea
> r
 11.                         
.         }
 12.         drop current_year
 13.         gen age1 = year - year_mass_layoff + age
 14.         gen age2 = age1^2
 15.         gen age3 = age1^3
 16.         gen age4 = age1^4
 17.         
.         sort pid year
 18.         xtset pid year
 19.         save "`filepath'/regression_annual_income_year_CTG5`yy'.dta" , rep
> lace  
 20.         
.         drop if age1>55
 21.         drop if year==2008
 22.         
.         local lastD = `maxround'+6
 23.         
.         xi: xtreg real_annual_income_coded i.year age1 age2 age3 age4 D_0 - D
> _`lastD' if sex==1, fe
 24.         xi: xtreg real_annual_income_coded i.year age1 age2 age3 age4 D_0 
> - D_`lastD' if sex==2, fe
 25.         
. }       
(39421425 missing values generated)
(39770468 missing values generated)
(39770468 real changes made)
(1699 real changes made)
(39770468 real changes made)
(7805 real changes made)
(39770468 real changes made)
(15359 real changes made)
(39770468 real changes made)
(15876 real changes made)
(39770468 real changes made)
(15893 real changes made)
(39770468 real changes made)
(15913 real changes made)
(39770468 real changes made)
(16022 real changes made)
(39770468 real changes made)
(14048 real changes made)
(39770468 real changes made)
(13842 real changes made)
(39770468 real changes made)
(13575 real changes made)
(39770468 real changes made)
(13271 real changes made)
(39770468 real changes made)
(12904 real changes made)
(39770468 real changes made)
(12448 real changes made)
(39770468 real changes made)
(12058 real changes made)
(39770468 real changes made)
(11671 real changes made)
(39770468 real changes made)
(11274 real changes made)
(39770468 real changes made)
(10883 real changes made)
(39770468 real changes made)
(10439 real changes made)
(39770468 real changes made)
(9984 real changes made)
(39770468 real changes made)
(9592 real changes made)
(39770468 real changes made)
(9189 real changes made)
(39770468 real changes made)
(8722 real changes made)
(39770468 real changes made)
(8278 real changes made)
(39770468 real changes made)
(7884 real changes made)
(39770468 real changes made)
(7392 real changes made)
(39770468 real changes made)
(6943 real changes made)
(39770468 real changes made)
(6561 real changes made)
(39770468 real changes made)
(6176 real changes made)
(39770468 real changes made)
(5729 real changes made)
(39770468 real changes made)
(5354 real changes made)
(39770468 real changes made)
(5023 real changes made)
(39770468 real changes made)
(4722 real changes made)
(39770468 real changes made)
(4421 real changes made)
(39770468 real changes made)
(4100 real changes made)
(39770468 real changes made)
(3837 real changes made)
(39770468 real changes made)
(3585 real changes made)
(39770468 real changes made)
(3258 real changes made)
(39770468 real changes made)
(2290 real changes made)
repeated time values within panel
r(451);

end of do-file
r(451);
